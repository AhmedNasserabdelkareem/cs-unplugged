{% extends "columns.html" %}

{% load render_html_field %}
{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
  {% breadcrumb "Home" "/" %}
  {% breadcrumb "Topics" "topics:index" %}
  {% breadcrumb topic.name "topics:topic" topic.slug %}
{% endblock breadcrumbs %}

{% block page_heading %}
  <h1 id="{{ topic.slug }}" class="heading-underline">{{ topic.name }}</h1>
{% endblock page_heading %}

{% block left_column_content %}
  {% render_html_field topic.content %}

  {% for unit_plan in unit_plans %}
    <div class="boxed-text">
      <div class="boxed-text-content">
        <h2 id="{{ unit_plan.slug }}">
          <a href="{% url 'topics:unit_plan' topic.slug unit_plan.slug %}">
            {{ unit_plan.name }}
          </a>
        </h2>

        {% if unit_plan.unit_plan_lessons %}
          {% for age_range, lessons in unit_plan.lessons.items %}
            <h3>
              Lessons for Ages {{ age_range.0 }} to {{ age_range.1 }}
            </h3>

            <ul>
              {% for lesson in lessons %}
                <li>
                  <a href="{% url 'topics:lesson' topic.slug unit_plan.slug lesson.slug %}">
                    <strong>Lesson {{ lesson.number }}:</strong> {{ lesson.name }}
                  </a>
                  {% if lesson.has_programming_exercises %}
                    <ul>
                      <li>
                        <a href="{% url 'topics:programming_exercises_list' topic.slug unit_plan.slug lesson.slug %}">
                          View Lesson Programming Challenges
                        </a>
                      </li>
                    </ul>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% endfor %}
        {% endif %}
      </div>
    </div>
  {% endfor %}

  <h2 id="integrations" class="heading-underline">Curriculum Integrations</h2>
  {% if curriculum_integrations %}
    <table class="table table-responsive table-center-vertical">
      <thead class="thead-default">
        <tr>
          <th>Activity</th>
          <th>Curriculum Areas</th>
          <th>Prerequisite Lessons?</th>
        </tr>
      </thead>
      <tbody>
        {% for curriculum_integration in curriculum_integrations %}
        <tr class="align-middle">
          <td>
            <a href="{% url 'topics:integration' curriculum_integration.topic.slug curriculum_integration.slug %}">
              <strong>
                {{ curriculum_integration.name }}
              </strong>
            </a>
          </td>
          <td>
            {% for area in curriculum_integration.curriculum_areas.all %}
              {% include "topics/curriculum-area-badge.html" %}
            {% endfor %}
          </td>
          {% if curriculum_integration.has_prerequisite_lessons %}
            <td class="text-center table-success-cell">
              Yes
          {% else %}
            <td class="text-center">
              No
          {% endif %}
            </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No curriculum integrations for {{ topic }}.</p>
  {% endif %}

  <h2 id="programming" class="heading-underline">Programming Challenges</h2>
  {% if programming_exercises %}
    <ul>
      {% for programming_exercise in programming_exercises %}
        <li>
          <a href="{% url 'topics:programming_exercise' topic.slug programming_exercise.slug %}">
            {{ programming_exercise.exercise_set_number }}.{{ programming_exercise.exercise_number }}
            {{ programming_exercise.name }}
          </a>
          {% include "topics/programming-difficulty-badge.html" %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No programming challenges for {{ topic }}.</p>
  {% endif %}

  {% if topic.other_resources %}
    <h2 id="other-resources" class="heading-underline">Looking for more?</h2>
    <p>
      <a href="{% url 'topics:other_resources' topic.slug %}">
        Click here for other resources
      </a>
    </p>
  {% endif %}
{% endblock left_column_content %}

{% block right_column_content %}
  <div id="sticky-sidebar" class="sticky">
    <h2 class="heading-underline">Table of contents</h2>
    <ul class="nav nav-pills flex-column" id="scrollspy-table-of-contents">
      <li class="nav-item">
        <a class="nav-link" href="#{{ topic.slug }}">{{ topic.name }}</a>
      </li>
      {% for unit_plan in unit_plans %}
        <li class="nav-item">
          <a class="nav-link" href="#{{ unit_plan.slug }}">{{ unit_plan.name }}</a>
        </li>
      {% endfor %}
      <li class="nav-item">
        <a class="nav-link" href="#integrations">Curriculum integrations</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#programming">Programming challenges</a>
      </li>
      {% if topic.other_resources %}
        <li class="nav-item">
          <a class="nav-link" href="#other-resources">Other resources</a>
        </li>
      {% endif %}
    </ul>
  </div>
{% endblock right_column_content %}

{% block scripts %}
  {% include "generic/import-stick-state-js.html" %}
{% endblock scripts %}
